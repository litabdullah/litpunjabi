{% extends "base.html" %}
{% load wagtailcore_tags %}

{% block title %}{{ page.title }} | Punjabi Sahit{% endblock %}

{% block extra_css %}
<style>
    /* Page-specific styles only */
    .ft-phrase-card {
        display: block;
        padding: var(--ft-space-6);
        text-decoration: none;
        border-left: 4px solid transparent;
    }

    .ft-phrase-card:hover {
        background-color: #fafaf9;
        border-left-color: var(--ft-color-teal);
        text-decoration: none;
    }

    .ft-phrase-card__gurmukhi {
        font-family: var(--ft-font-gurmukhi);
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--ft-color-slate);
        margin-bottom: var(--ft-space-4);
        line-height: 1.3;
    }

    .ft-phrase-card__roman {
        font-family: var(--ft-font-body);
        font-size: 1rem;
        font-weight: 500;
        color: var(--ft-text-tertiary);
        margin-bottom: var(--ft-space-4);
    }

    .ft-phrase-card__translation {
        font-size: 0.9375rem;
        line-height: 1.7;
        color: var(--ft-text-secondary);
        margin-bottom: var(--ft-space-4);
    }

    .ft-phrase-meta {
        display: flex;
        align-items: center;
        gap: var(--ft-space-2);
        font-size: 0.8125rem;
        color: var(--ft-text-tertiary);
        margin-top: var(--ft-space-4);
        padding-top: var(--ft-space-4);
        border-top: 1px solid rgba(13, 118, 128, 0.1);
    }

    .ft-phrase-meta svg {
        width: 1rem;
        height: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<main class="ft-container ft-space-6xl">
    <!-- Section Header -->
    <section class="ft-card ft-card--prominent ft-space-3xl">
        <h1 class="ft-section-heading">{{ page.title }}</h1>
        {% if page.intro %}
        <div class="ft-rich-text" style="max-width: 700px; padding: var(--ft-space-6); border-left: 5px solid var(--ft-color-teal); background-color: rgba(255, 255, 255, 0.7); border-radius: var(--ft-radius-md); box-shadow: var(--ft-shadow-sm);">
            {{ page.intro|richtext }}
        </div>
        {% endif %}
    </section>

    <!-- Table Toolbar Pattern -->
    <div class="ft-table-toolbar ft-space-xl" style="position: sticky; top: 60px; z-index: 30; background-color: var(--ft-bg-card); border: 2px solid rgba(13, 118, 128, 0.2); border-radius: var(--ft-radius-xl); box-shadow: var(--ft-shadow-xl); padding: var(--ft-space-6); margin-bottom: var(--ft-space-8);">
        <form method="get" action="" style="display: flex; flex-wrap: wrap; gap: var(--ft-space-4); align-items: end; width: 100%;">
            <!-- Search Box -->
            <div style="flex: 1; min-width: 250px;">
                <label class="o-forms-label">Search Phrases</label>
                <div style="position: relative;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--ft-text-tertiary);">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <input type="text"
                           name="q"
                           value="{{ search_query|default:'' }}"
                           placeholder="Search phrases..."
                           class="o-forms-input__text"
                           style="padding-left: 40px;"
                           onchange="this.form.submit()">
                </div>
            </div>

            <!-- Filters Group -->
            <div class="ft-table-actions">
                <!-- Category Filter -->
                <div style="min-width: 180px;">
                    <label class="o-forms-label">Category</label>
                    <select name="category" class="ft-select" onchange="this.form.submit()">
                        <option value="">All Categories</option>
                        <option value="greetings" {% if current_category == 'greetings' %}selected{% endif %}>Greetings</option>
                        <option value="common" {% if current_category == 'common' %}selected{% endif %}>Common</option>
                        <option value="formal" {% if current_category == 'formal' %}selected{% endif %}>Formal</option>
                        <option value="informal" {% if current_category == 'informal' %}selected{% endif %}>Informal</option>
                        <option value="conversational" {% if current_category == 'conversational' %}selected{% endif %}>Conversational</option>
                    </select>
                </div>

                <!-- Sort Dropdown -->
                <div style="min-width: 180px;">
                    <label class="o-forms-label">Sort By</label>
                    <select name="sort" class="ft-select" onchange="this.form.submit()">
                        <option value="alpha_asc" {% if current_sort == 'alpha_asc' %}selected{% endif %}>A → Z</option>
                        <option value="alpha_desc" {% if current_sort == 'alpha_desc' %}selected{% endif %}>Z → A</option>
                        <option value="popular" {% if current_sort == 'popular' %}selected{% endif %}>Most Viewed</option>
                        <option value="recent" {% if current_sort == 'recent' %}selected{% endif %}>Recently Added</option>
                    </select>
                </div>

                <!-- Results Count -->
                <div style="padding-bottom: 10px;">
                    <span class="ft-stat-number" style="margin-right: 8px;">{{ phrases.paginator.count }}</span>
                    <span class="ft-stat-label" style="display: inline;">phrase{% if phrases.paginator.count != 1 %}s{% endif %}</span>
                </div>

                <!-- Clear Filters -->
                {% if request.GET.urlencode %}
                <div style="padding-bottom: 10px;">
                    <a href="?" class="o-buttons o-buttons__secondary" style="font-size: 0.875rem; padding: 0.5em 1em;">
                        Clear Filters
                    </a>
                </div>
                {% endif %}
            </div>
        </form>
    </div>

    <!-- Phrases Grid -->
    <div class="ft-grid ft-grid--2 ft-space-xl">
        {% for phrase in phrases %}
        <a href="{{ phrase.url }}" class="ft-card ft-phrase-card">
            <div style="display: flex; align-items: start; justify-content: space-between; gap: var(--ft-space-4);">
                <div style="flex: 1; min-width: 0;">
                    <!-- Phrase Text -->
                    <h2 class="ft-phrase-card__gurmukhi">{{ phrase.phrase_gurmukhi }}</h2>
                    <p class="ft-phrase-card__roman">{{ phrase.roman_simple }}</p>

                    <!-- English Translation -->
                    <p class="ft-phrase-card__translation">{{ phrase.translation_english|truncatewords:15 }}</p>

                    <!-- Category Badge -->
                    {% if phrase.category %}
                    <span class="ft-badge">{{ phrase.category }}</span>
                    {% endif %}

                    <!-- View Count -->
                    <div class="ft-phrase-meta">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                        </svg>
                        <span>{{ phrase.view_count }} views</span>
                    </div>
                </div>

                <!-- Arrow Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: var(--ft-text-tertiary); transition: var(--ft-transition-base); flex-shrink: 0; margin-top: 4px;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </div>
        </a>
        {% empty %}
        <div class="ft-card ft-text-center" style="grid-column: 1 / -1; border: 3px dashed rgba(13, 118, 128, 0.3); padding: var(--ft-space-12);">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: var(--ft-text-tertiary); margin: 0 auto var(--ft-space-6);">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h3 style="font-size: 1.25rem; margin-bottom: var(--ft-space-4); color: var(--ft-color-slate);">No phrases found</h3>
            <p style="color: var(--ft-text-tertiary); margin-bottom: var(--ft-space-6);">Try adjusting your search or filters</p>
            {% if request.GET.urlencode %}
            <a href="?" class="o-buttons o-buttons__primary">Clear All Filters</a>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <!-- Pagination Controls -->
    {% if phrases.paginator.num_pages > 1 %}
    <div class="ft-card ft-text-center" style="margin-top: var(--ft-space-8); display: flex; justify-content: center; align-items: center; gap: var(--ft-space-3); flex-wrap: wrap;">
        {% if phrases.has_previous %}
        <a href="?page={{ phrases.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}"
           class="o-buttons o-buttons__secondary">
            ← Previous
        </a>
        {% endif %}

        <span style="padding: 0.75em 1.5em; font-weight: 600; color: var(--ft-color-slate);">
            Page {{ phrases.number }} of {{ phrases.paginator.num_pages }}
        </span>

        {% if phrases.has_next %}
        <a href="?page={{ phrases.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}"
           class="o-buttons o-buttons__secondary">
            Next →
        </a>
        {% endif %}
    </div>
    {% endif %}
</main>
{% endblock %}
