{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block title %}{{ page.title }} | Punjabi Sahit{% endblock %}

{% block extra_css %}
<style>
    /* ============================================
       AUTHORS PAGE - FT ORIGAMI CUSTOMIZATIONS
       ============================================ */

    /* Filter Bar - FT Style */
    .ft-filter-bar {
        position: sticky;
        top: 60px;
        z-index: 30;
        background-color: var(--ft-bg-card); border: 2px solid rgba(13, 118, 128, 0.2); border-radius: var(--ft-radius-lg); box-shadow: var(--ft-shadow-md);
        padding: var(--ft-space-3xl);
        margin-bottom: var(--ft-space-2xl);
    }

    /* Author Card - FT Style */
    .ft-author-card {
        background-color: var(--ft-bg-card); border: 2px solid rgba(13, 118, 128, 0.2); border-radius: var(--ft-radius-lg); box-shadow: var(--ft-shadow-md);
        padding: var(--ft-space-4xl); text-align: center;
        transition: var(--ft-transition-base);
    }

    .ft-author-card:hover {
        box-shadow: var(--ft-shadow-md);
        border-color: var(--ft-color-oxford);
    }

    .ft-author-photo {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        margin: 0 auto var(--ft-space-lg);
        border: 3px solid var(--ft-color-paper);
        box-shadow: var(--ft-shadow-md);
    }

    .ft-author-name-gurmukhi { font-family: var(--ft-font-gurmukhi); font-size: 1.5rem; font-weight: 700; color: var(--ft-color-slate); margin-bottom: var(--ft-space-md); padding: var(--ft-space-sm) 0;
        line-height: 1.3;
    }

    .ft-author-name-english {
        font-family: var(--ft-font-headline);
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--ft-text-tertiary);
    }

    .ft-author-dates {
        font-size: 0.875rem;
        color: var(--ft-text-tertiary);
        margin-top: var(--ft-space-sm);
        margin-bottom: var(--ft-space-md);
    }

    .ft-author-badge {
        display: inline-block;
        padding: 4px 12px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        background-color: var(--ft-color-oxford);
        color: var(--ft-text-inverse);
        border-radius: var(--ft-radius-md);
        margin-bottom: var(--ft-space-md);
    }

    .ft-author-bio { font-size: 0.875rem; line-height: 1.7; color: var(--ft-text-secondary); margin-bottom: var(--ft-space-2xl); padding: var(--ft-space-lg) var(--ft-space-md);
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
{% endblock %}

{% block content %}
<main class="ft-container ft-py-lg" style="padding: var(--ft-space-6xl);">
    <!-- FT Section Header -->
    <section style="border: 3px solid var(--ft-color-slate); border-radius: var(--ft-radius-xl); box-shadow: var(--ft-shadow-lg); background-color: var(--ft-bg-card); padding: var(--ft-space-6) var(--ft-space-4); margin-bottom: var(--ft-space-12);">
        <h1 style="font-family: var(--ft-font-headline); font-size: 2rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--ft-color-slate); padding: var(--ft-space-4) 0;; padding: var(--ft-space-6); border-bottom: 3px solid rgba(13, 118, 128, 0.2); margin-bottom: var(--ft-space-6);">{{ page.title }}</h1>
        {% if page.intro %}
        <div style="max-width: 700px; padding: var(--ft-space-6); border-left: 5px solid var(--ft-color-teal); background-color: rgba(255, 255, 255, 0.7); border-radius: var(--ft-radius-md); box-shadow: var(--ft-shadow-sm); margin-top: var(--ft-space-6); margin-bottom: var(--ft-space-8);">
            <div style="font-size: 1rem; line-height: 1.8; color: var(--ft-text-secondary); padding: var(--ft-space-4);">{{ page.intro|richtext }}
            </div>
        </div>
        {% endif %}
    </section>

    <!-- Filter Bar (Sticky) -->
    <div class="ft-filter-bar" style="border: 2px solid rgba(13, 118, 128, 0.25); border-radius: var(--ft-radius-xl); box-shadow: var(--ft-shadow-xl); padding: var(--ft-space-5xl); margin-bottom: var(--ft-space-5xl);">
        <form method="get" action="" style="display: flex; flex-wrap: wrap; gap: var(--ft-space-4); align-items: end;">

            <!-- Search Box -->
            <div style="flex: 1; min-width: 280px;">
                <label class="o-forms-label">Search Authors</label>
                <div style="position: relative;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--ft-text-tertiary);">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <input type="text"
                           name="q"
                           value="{{ search_query|default:'' }}"
                           placeholder="Search authors..."
                           class="o-forms-input__text"
                           style="padding-left: 40px;"
                           onchange="this.form.submit()">
                </div>
            </div>

            <!-- Literary Style Filter -->
            <div style="min-width: 200px;">
                <label class="o-forms-label">Literary Style</label>
                <input type="text"
                       name="style"
                       value="{{ request.GET.style|default:'' }}"
                       placeholder="Filter by style..."
                       class="o-forms-input__text"
                       onchange="this.form.submit()">
            </div>

            <!-- Sort Dropdown -->
            <div style="min-width: 200px;">
                <label class="o-forms-label">Sort By</label>
                <select name="sort" class="o-forms-input__text" onchange="this.form.submit()">
                    <option value="name" {% if current_sort == 'name' %}selected{% endif %}>A → Z</option>
                    <option value="birth_year" {% if current_sort == 'birth_year' %}selected{% endif %}>By Birth Year</option>
                    <option value="popular" {% if current_sort == 'popular' %}selected{% endif %}>Most Viewed</option>
                </select>
            </div>

            <!-- Results Count -->
            <div style="padding-bottom: 10px;">
                <span style="font-family: var(--ft-font-headline); font-size: 1.5rem; font-weight: 700; color: var(--ft-color-oxford); margin-right: 8px;">{{ authors.paginator.count }}</span>
                <span style="font-family: var(--ft-font-body); font-weight: 500; color: var(--ft-color-slate);">author{% if authors.paginator.count != 1 %}s{% endif %}</span>
            </div>

            <!-- Clear Filters -->
            {% if request.GET.urlencode %}
            <div style="padding-bottom: 10px;">
                <a href="?" class="o-buttons o-buttons__secondary" style="font-size: 0.875rem; padding: 0.5em 1em;">
                    Clear Filters
                </a>
            </div>
            {% endif %}
        </form>
    </div>

    <!-- Authors Grid -->
    <div class="ft-grid ft-grid--3" style="padding: var(--ft-space-6); gap: var(--ft-space-4xl);" style="gap: var(--ft-space-3xl);">
        {% for author in authors %}
        <div class="ft-author-card" style="border: 2px solid rgba(13, 118, 128, 0.2); border-radius: var(--ft-radius-xl); box-shadow: var(--ft-shadow-lg);">
            <!-- Author Photo -->
            <div>
                {% if author.profile_photo %}
                    {% image author.profile_photo fill-120x120 as photo %}
                    <img src="{{ photo.url }}" alt="{{ author.name_english|default:author.name }}" class="ft-author-photo">
                {% elif author.profile_image %}
                    <img src="{{ author.profile_image }}" alt="{{ author.name_english|default:author.name }}" class="ft-author-photo">
                {% else %}
                    <div class="ft-author-photo" style="background: linear-gradient(135deg, var(--ft-color-grey-1), var(--ft-color-ft-pink)); display: flex; align-items: center; justify-content: center;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: var(--ft-color-oxford);">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </div>
                {% endif %}
            </div>

            <!-- Author Names -->
            <div style="margin-bottom: var(--ft-space-6); padding: var(--ft-space-4) 0;">
                {% if author.name_gurmukhi %}
                <h2 class="ft-author-name-gurmukhi">
                    {{ author.name_gurmukhi }}
                </h2>
                {% endif %}
                <h3 class="ft-author-name-english">
                    {{ author.name_english|default:author.name }}
                </h3>
            </div>

            <!-- Life Dates -->
            {% if author.birth_date or author.death_date %}
            <p class="ft-author-dates">
                {% if author.birth_date %}{{ author.birth_date.year }}{% endif %}
                {% if author.death_date %} – {{ author.death_date.year }}{% elif author.birth_date %} – Present{% endif %}
            </p>
            {% endif %}

            <!-- Literary Style -->
            {% if author.literary_style %}
            <span class="ft-author-badge" style="box-shadow: var(--ft-shadow-sm); border-radius: var(--ft-radius-md);" style="margin: var(--ft-space-4) 0;">{{ author.literary_style|truncatewords:3 }}</span>
            {% endif %}

            <!-- Bio Preview -->
            {% if author.biography_english or author.bio %}
            <p class="ft-author-bio">
                {{ author.biography_english|striptags|truncatewords:20|default:author.bio|truncatewords:20 }}
            </p>
            {% endif %}

            <!-- View Profile Button -->
            <a href="{% if author.detail_pages.first %}{{ author.detail_pages.first.url }}{% else %}#{% endif %}"
               class="o-buttons o-buttons__primary"
               style="width: 100%; display: inline-flex; align-items: center; justify-content: center; gap: var(--ft-space-2);">
                View Profile
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </a>

            <!-- View Count -->
            <div style="display: flex; align-items: center; justify-content: center; gap: var(--ft-space-2); margin-top: var(--ft-space-6); padding-top: var(--ft-space-4); font-size: 0.75rem; color: var(--ft-text-tertiary);">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
                <span>{{ author.view_count }} views</span>
            </div>
        </div>
        {% empty %}
        <div style="grid-column: 1 / -1; border: 3px dashed rgba(13, 118, 128, 0.3); border-radius: var(--ft-radius-2xl); padding: var(--ft-space-6xl) var(--ft-space-4xl); text-align: center; background: var(--ft-bg-card); border: 1px solid rgba(13, 118, 128, 0.15);">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: var(--ft-color-grey-2); margin: 0 auto 24px;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <h3 style="font-family: var(--ft-font-headline); font-size: 1.25rem; margin-bottom: var(--ft-space-4); padding-bottom: var(--ft-space-2); color: var(--ft-color-slate);; padding: var(--ft-space-3) 0; margin-top: var(--ft-space-4);">No authors found</h3>
            <p style="color: var(--ft-text-tertiary); margin-bottom: var(--ft-space-6); padding: var(--ft-space-2) var(--ft-space-4);">Try adjusting your search or filters</p>
            {% if request.GET.urlencode %}
            <a href="?" class="o-buttons o-buttons__primary">Clear All Filters</a>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <!-- Pagination Controls -->
    {% if authors.paginator.num_pages > 1 %}
    <div style="margin-top: var(--ft-space-8); padding: var(--ft-space-6); display: flex; justify-content: center; background-color: rgba(255, 255, 255, 0.3); border-radius: var(--ft-radius-lg); align-items: center; gap: var(--ft-space-3); flex-wrap: wrap;">
        {% if authors.has_previous %}
        <a href="?page={{ authors.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.style %}&style={{ request.GET.style }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}"
           class="o-buttons o-buttons__secondary">
            ← Previous
        </a>
        {% endif %}

        <span style="padding: 0.75em 1.5em; font-family: var(--ft-font-body); font-weight: 600; color: var(--ft-color-slate);">
            Page {{ authors.number }} of {{ authors.paginator.num_pages }}
        </span>

        {% if authors.has_next %}
        <a href="?page={{ authors.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.style %}&style={{ request.GET.style }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}"
           class="o-buttons o-buttons__secondary">
            Next →
        </a>
        {% endif %}
    </div>
    {% endif %}
</main>
{% endblock %}
