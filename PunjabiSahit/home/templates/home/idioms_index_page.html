{% extends "base.html" %}
{% load wagtailcore_tags %}

{% block title %}{{ page.title }} | Punjabi Sahit{% endblock %}

{% block extra_css %}
<style>
    /* ============================================
       IDIOMS PAGE - FT ORIGAMI CUSTOMIZATIONS
       ============================================ */

    /* Filter Bar - FT Style */
    .ft-filter-bar {
        position: sticky;
        top: 60px;
        z-index: 30;
        background-color: var(--ft-bg-card); border: 2px solid rgba(13, 118, 128, 0.2); border-radius: var(--ft-radius-lg); box-shadow: var(--ft-shadow-md);
        padding: var(--ft-space-3xl);
        margin-bottom: var(--ft-space-2xl);
    }

    /* Idiom Card - FT Style */
    .ft-idiom-card {
        display: block;
        padding: var(--ft-space-4xl);
        background-color: var(--ft-bg-card); border: 2px solid rgba(13, 118, 128, 0.2); border-radius: var(--ft-radius-lg); box-shadow: var(--ft-shadow-md);
        border-left: 4px solid transparent;
        margin-bottom: var(--ft-space-lg);
        text-decoration: none;
        transition: var(--ft-transition-base);
    }

    .ft-idiom-card:hover {
        background-color: #fafaf9;
        border-left-color: var(--ft-color-oxford);
        box-shadow: var(--ft-shadow-md);
        text-decoration: none;
    }

    .ft-idiom-card__gurmukhi {
        font-family: var(--ft-font-gurmukhi);
        font-size: 2rem;
        font-weight: 700;
        color: var(--ft-color-slate);
        margin-bottom: var(--ft-space-xs);
        line-height: 1.3;
    }

    .ft-idiom-card__roman {
        font-family: var(--ft-font-body);
        font-size: 1.125rem;
        font-weight: 500;
        color: var(--ft-text-tertiary);
        margin-bottom: var(--ft-space-md);
    }

    .ft-idiom-card__definition {
        font-size: 0.9375rem;
        line-height: 1.6;
        color: var(--ft-text-secondary);
        margin-bottom: var(--ft-space-md);
    }

    .ft-idiom-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 12px;
        font-size: 0.75rem;
        font-weight: 600;
        background-color: var(--ft-color-oxford);
        color: var(--ft-text-inverse);
        border-radius: var(--ft-radius-md);
    }

    .ft-idiom-badge svg {
        width: 14px;
        height: 14px;
    }

    .ft-idiom-meta {
        display: flex;
        align-items: center;
        gap: var(--ft-space-md);
        font-size: 0.8125rem;
        color: var(--ft-text-tertiary);
        margin-top: var(--ft-space-md);
    }

    .ft-idiom-meta svg {
        width: 1rem;
        height: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<main class="ft-container ft-py-lg" style="padding: var(--ft-space-6xl);">
    <!-- FT Section Header -->
    <section style="border: 3px solid var(--ft-color-slate); border-radius: var(--ft-radius-xl); box-shadow: var(--ft-shadow-lg); background-color: var(--ft-bg-card); padding: var(--ft-space-6) var(--ft-space-4); margin-bottom: var(--ft-space-12);">
        <h1 style="font-family: var(--ft-font-headline); font-size: 2rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--ft-color-slate); padding: var(--ft-space-4) 0;; padding: var(--ft-space-6); border-bottom: 3px solid rgba(13, 118, 128, 0.2); margin-bottom: var(--ft-space-6);">{{ page.title }}</h1>
        {% if page.intro %}
        <div style="max-width: 700px; padding: var(--ft-space-6); border-left: 5px solid var(--ft-color-teal); background-color: rgba(255, 255, 255, 0.7); border-radius: var(--ft-radius-md); box-shadow: var(--ft-shadow-sm); margin-top: var(--ft-space-6); margin-bottom: var(--ft-space-8);">
            <div style="font-size: 1rem; line-height: 1.8; color: var(--ft-text-secondary); padding: var(--ft-space-4);">{{ page.intro|richtext }}
            </div>
        </div>
        {% endif %}
    </section>

    <!-- Filter Bar (Sticky) -->
    <div class="ft-filter-bar" style="border: 2px solid rgba(13, 118, 128, 0.25); border-radius: var(--ft-radius-xl); box-shadow: var(--ft-shadow-xl); padding: var(--ft-space-5xl); margin-bottom: var(--ft-space-5xl);">
        <form method="get" action="" style="display: flex; flex-wrap: wrap; gap: var(--ft-space-4); align-items: end;">

            <!-- Search Box -->
            <div style="flex: 1; min-width: 300px;">
                <label class="o-forms-label">Search Idioms</label>
                <div style="position: relative;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--ft-text-tertiary);">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <input type="text"
                           name="q"
                           value="{{ search_query|default:'' }}"
                           placeholder="Search idioms..."
                           class="o-forms-input__text"
                           style="padding-left: 40px;"
                           onchange="this.form.submit()">
                </div>
            </div>

            <!-- Sort Dropdown -->
            <div style="min-width: 200px;">
                <label class="o-forms-label">Sort By</label>
                <select name="sort" class="o-forms-input__text" onchange="this.form.submit()">
                    <option value="alpha_asc" {% if current_sort == 'alpha_asc' %}selected{% endif %}>A → Z</option>
                    <option value="alpha_desc" {% if current_sort == 'alpha_desc' %}selected{% endif %}>Z → A</option>
                    <option value="popular" {% if current_sort == 'popular' %}selected{% endif %}>Most Viewed</option>
                    <option value="recent" {% if current_sort == 'recent' %}selected{% endif %}>Recently Added</option>
                </select>
            </div>

            <!-- Results Count -->
            <div style="padding-bottom: 10px;">
                <span style="font-family: var(--ft-font-headline); font-size: 1.5rem; font-weight: 700; color: var(--ft-color-oxford); margin-right: 8px;">{{ idioms.paginator.count }}</span>
                <span style="font-family: var(--ft-font-body); font-weight: 500; color: var(--ft-color-slate);">idiom{% if idioms.paginator.count != 1 %}s{% endif %}</span>
            </div>

            <!-- Clear Filters -->
            {% if request.GET.urlencode %}
            <div style="padding-bottom: 10px;">
                <a href="?" class="o-buttons o-buttons__secondary" style="font-size: 0.875rem; padding: 0.5em 1em;">
                    Clear Filters
                </a>
            </div>
            {% endif %}
        </form>
    </div>

    <!-- Idioms List -->
    <div>
        {% for idiom in idioms %}
        <a href="{{ idiom.url }}" class="ft-idiom-card">
            <div style="display: flex; align-items: start; justify-content: space-between; gap: var(--ft-space-4);">
                <div style="flex: 1; min-width: 0; padding: var(--ft-space-4);">
                    <!-- Idiom Text -->
                    <h2 class="ft-idiom-card__gurmukhi">{{ idiom.idiom_gurmukhi }}</h2>
                    <p class="ft-idiom-card__roman">{{ idiom.transliteration_roman_simple }}</p>

                    <!-- Definition Preview -->
                    <p class="ft-idiom-card__definition">{{ idiom.definition_english|truncatewords:30 }}</p>

                    <!-- Western Equivalent Badge -->
                    {% if idiom.western_phrase %}
                    <span class="ft-idiom-badge">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
                        </svg>
                        Has Western Equivalent
                    </span>
                    {% endif %}

                    <!-- View Count -->
                    <div class="ft-idiom-meta">
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                            <span>{{ idiom.view_count }} views</span>
                        </div>
                    </div>
                </div>

                <!-- Arrow Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: var(--ft-color-grey-2); transition: var(--ft-transition-base); flex-shrink: 0; margin-top: 8px;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </div>
        </a>
        {% empty %}
        <div style="padding: 64px 32px; text-align: center; background: var(--ft-bg-card); border: 1px solid rgba(13, 118, 128, 0.15);">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: var(--ft-color-grey-2); margin: 0 auto 24px;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h3 style="font-family: var(--ft-font-headline); font-size: 1.25rem; margin-bottom: var(--ft-space-4); padding-bottom: var(--ft-space-2); color: var(--ft-color-slate);; padding: var(--ft-space-3) 0; margin-top: var(--ft-space-4);">No idioms found</h3>
            <p style="color: var(--ft-text-tertiary); margin-bottom: var(--ft-space-6); padding: var(--ft-space-2) var(--ft-space-4);">Try adjusting your search or filters</p>
            {% if request.GET.urlencode %}
            <a href="?" class="o-buttons o-buttons__primary">Clear All Filters</a>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <!-- Pagination Controls -->
    {% if idioms.paginator.num_pages > 1 %}
    <div style="margin-top: var(--ft-space-8); padding: var(--ft-space-6); display: flex; justify-content: center; background-color: rgba(255, 255, 255, 0.3); border-radius: var(--ft-radius-lg); align-items: center; gap: var(--ft-space-3); flex-wrap: wrap;">
        {% if idioms.has_previous %}
        <a href="?page={{ idioms.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}"
           class="o-buttons o-buttons__secondary">
            ← Previous
        </a>
        {% endif %}

        <span style="padding: 0.75em 1.5em; font-family: var(--ft-font-body); font-weight: 600; color: var(--ft-color-slate);">
            Page {{ idioms.number }} of {{ idioms.paginator.num_pages }}
        </span>

        {% if idioms.has_next %}
        <a href="?page={{ idioms.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}"
           class="o-buttons o-buttons__secondary">
            Next →
        </a>
        {% endif %}
    </div>
    {% endif %}
</main>
{% endblock %}
